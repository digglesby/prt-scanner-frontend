<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="functions" href="functions.js">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="prtdata" href="https://watjl80v2k.execute-api.us-east-1.amazonaws.com/Test1">

    <title>P.R.T. Scanner</title>
  </head>
<!-- onLoad="prtStatusFunction();" -->
  <body  style="background-color: white";>
    <h1>PRT Scanner (DEV)</h1>
    <div class="topnav" id="myTopnav">
      <a href="#home" class="active">Home</a>
      <a href="#news">Stochastics (N/A)</a>
      <a href="#contact">Contact (N/A)</a>
      <a href="#about">About (N/A)</a>
      <a href="javascript:void(0);" style="font-size:15px;" class="icon" onclick="myFunction()">&#9776;</a>
    </div>

    <div class="PrtStatusBody" id="PrtStatusBody">
      <h2>Current PRT Status</h2>
      <p>
        <span class="StationStatus" id="StationStatus">Beechurst Station: </span>
          <span class="PRTLoading_B" id="PRTLoading_B">Loading...</span> <img id="PRTIcon_B" src=""/>
        <br style="display=none"></br>

        <span class="StationStatus" id="StationStatus">Evansdale Station: </span>
          <span class="PRTLoading_Evan" id="PRTLoading_Evan">Loading...</span> <img id="PRTIcon_Evan" src=""/>
        <br style="display=none"></br>

        <span class="StationStatus" id="StationStatus">Enginnering Station: </span>
          <span class="PRTLoading_Eng" id="PRTLoading_Eng">Loading...</span> <img id="PRTIcon_Eng" src=""/>
        <br style="display=none"></br>

        <span class="StationStatus" id="StationStatus">HSC Station: </span>
          <span class="PRTLoading_H" id="PRTLoading_H">Loading...</span> <img id="PRTIcon_H" src=""/>
        <br style="display=none"></br>

        <span class="StationStatus" id="StationStatus">Walnut Station: </span>
          <span class="PRTLoading_W" id="PRTLoading_W">Loading...</span> <img id="PRTIcon_W" src=""/>
      </p>
      <h2>Graphs</h2>
      <p>Graph 1</p>
      <p>Graph 2</p>
      <p>Graph 3</p>
    </div>

    <script>
    $.ajax(
    {
      type: "GET",
      url: "https://watjl80v2k.execute-api.us-east-1.amazonaws.com/Test1",
      data: "",
      crossDomain: true,
      dataType: 'json',
      success: function(data, status)
      {

        console.log("Status: "+ status + " connecting to apigateway." + "\n\nData:");

        // This for loop looks at the first array and outputs the first element in that array.
        // If it contains "Mention/Error" or "retweet" then it will output null.
        // We will change the status of all the stations to "closed" if it is null.
        var currentStatus = "null";
        if (data[1].length != 0)
        {
          for (var a = 0; a < data[1].length; a++)
          {
            console.log(data[1][a]);
            if (data[1][a].IsDown != "Mention/Error" || data[1][a].IsDown != "retweet")
            {
              currentStatus = data[1][a].IsDown;
              break;
            }
          }
        }

        // First date with elements in the array.
        console.log("Current Status of the PRT: " + currentStatus);
        prtStatusFunction(currentStatus);
      },

      error: function(response)
      {
        console.log(response);
      },

    });

    function myFunction()
    {
      var x = document.getElementById("myTopnav");
      if (x.className === "topnav") {
        x.className += " responsive";
      } else
      {
        x.className = "topnav";
      }
    }

    function prtStatusFunction(currentStatus)
    {
      let listOfStations = ["PRTLoading_B", "PRTLoading_Evan", "PRTLoading_Eng", "PRTLoading_H", "PRTLoading_W"];
      let listStationIcons = ["PRTIcon_B", "PRTIcon_Evan", "PRTIcon_Eng", "PRTIcon_H", "PRTIcon_W"];

      if (currentStatus != "null")
      {
        //PRTLoading_B
        document.getElementById(listOfStations[0]).innerHTML = "Running";
        document.getElementById(listOfStations[0]).className = 'PRTRunning';
        document.getElementById(listStationIcons[0]).src = "prtRunning.ico";

        //PRTLoading_Evan
        document.getElementById(listOfStations[1]).innerHTML = "Running";
        document.getElementById(listOfStations[1]).className = 'PRTRunning';
        document.getElementById(listStationIcons[1]).src = "prtRunning.ico";

        //PRTLoading_Eng
        document.getElementById(listOfStations[2]).innerHTML = "Running";
        document.getElementById(listOfStations[2]).className = 'PRTRunning';
        document.getElementById(listStationIcons[2]).src = "prtRunning.ico";

        //PRTLoading_H
        document.getElementById(listOfStations[3]).innerHTML = "Running";
        document.getElementById(listOfStations[3]).className = 'PRTRunning';
        document.getElementById(listStationIcons[3]).src = "prtRunning.ico";

        //PRTLoading_W
        document.getElementById(listOfStations[4]).innerHTML = "Running";
        document.getElementById(listOfStations[4]).className = 'PRTRunning';
        document.getElementById(listStationIcons[4]).src = "prtRunning.ico";

      }

      else if (currentStatus != "null")
      {
        document.getElementById(listOfStations[0]).innerHTML = "Down";
        document.getElementById(listOfStations[0]).className = 'PRTDown';
        document.getElementById(listStationIcons[0]).src = "prtDown.ico";

        document.getElementById(listOfStations[1]).innerHTML = "Down";
        document.getElementById(listOfStations[1]).className = 'PRTDown';
        document.getElementById(listStationIcons[1]).src = "prtDown.ico";

        document.getElementById(listOfStations[2]).innerHTML = "Down";
        document.getElementById(listOfStations[2]).className = 'PRTDown';
        document.getElementById(listStationIcons[2]).src = "prtDown.ico";

        document.getElementById(listOfStations[3]).innerHTML = "Down";
        document.getElementById(listOfStations[3]).className = 'PRTDown';
        document.getElementById(listStationIcons[3]).src = "prtDown.ico";

        document.getElementById(listOfStations[4]).innerHTML = "Down";
        document.getElementById(listOfStations[4]).className = 'PRTDown';
        document.getElementById(listStationIcons[4]).src = "prtDown.ico";
      }

      else
      {
        document.getElementById(listOfStations[0]).innerHTML = "Closed";
        document.getElementById(listOfStations[0]).className = 'PRTDown';

        document.getElementById(listOfStations[1]).innerHTML = "Closed";
        document.getElementById(listOfStations[1]).className = 'PRTDown';

        document.getElementById(listOfStations[2]).innerHTML = "Closed";
        document.getElementById(listOfStations[2]).className = 'PRTDown';

        document.getElementById(listOfStations[3]).innerHTML = "Closed";
        document.getElementById(listOfStations[3]).className = 'PRTDown';

        document.getElementById(listOfStations[4]).innerHTML = "Closed";
        document.getElementById(listOfStations[4]).className = 'PRTDown';
      }

    }
    </script>
  </body>

</html>
