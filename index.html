<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="functions" href="functions.js">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="prtdata" href="https://watjl80v2k.execute-api.us-east-1.amazonaws.com/Test1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.2"></script>

    <title>P.R.T. Scanner</title>
  </head>
<!-- onLoad="prtStatusFunction();" -->
  <body  style="background-color: white";>
    <h1>PRT Scanner (DEV)</h1>
    <div class="topnav" id="myTopnav">
      <a href="#home" class="active">Home</a>
      <a href="#news">Stochastics (N/A)</a>
      <a href="#contact">Contact (N/A)</a>
      <a href="#about">About (N/A)</a>
      <a href="javascript:void(0);" style="font-size:15px;" class="icon" onclick="myFunction()">&#9776;</a>
    </div>

    <div class="PrtStatusBody" id="PrtStatusBody">
      <h2>Current PRT Status</h2>
      <p>
        <span class="StationStatus" id="StationStatus">Beechurst Station: </span>
          <span class="PRTLoading_B" id="PRTLoading_B">Loading...</span> <img id="PRTIcon_B" src=""/>
        <br style="display=none"></br>

        <span class="StationStatus" id="StationStatus">Evansdale Station: </span>
          <span class="PRTLoading_Evan" id="PRTLoading_Evan">Loading...</span> <img id="PRTIcon_Evan" src=""/>
        <br style="display=none"></br>

        <span class="StationStatus" id="StationStatus">Enginnering Station: </span>
          <span class="PRTLoading_Eng" id="PRTLoading_Eng">Loading...</span> <img id="PRTIcon_Eng" src=""/>
        <br style="display=none"></br>

        <span class="StationStatus" id="StationStatus">HSC Station: </span>
          <span class="PRTLoading_H" id="PRTLoading_H">Loading...</span> <img id="PRTIcon_H" src=""/>
        <br style="display=none"></br>

        <span class="StationStatus" id="StationStatus">Walnut Station: </span>
          <span class="PRTLoading_W" id="PRTLoading_W">Loading...</span> <img id="PRTIcon_W" src=""/>
      </p>
      <h2>Graphs</h2>
      <canvas id="histogram"></canvas>
      <p>Graph 2</p>
      <p>Graph 3</p>
    </div>

    <script>
    $.ajax(
    {
      type: "GET",
      url: "https://watjl80v2k.execute-api.us-east-1.amazonaws.com/Test1",
      data: "",
      crossDomain: true,
      dataType: 'json',
      success: function(data, status)
      {

        console.log("Status: "+ status + " connecting to apigateway." + "\nData:");
        prtStatusFunction(data);

      },

      error: function(response)
      {
        console.log(response);
      },

    });

    var ctx = document.getElementById('histogram').getContext('2d');
    var chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'bar',

    // The data for our dataset
    data: {
        datasets: [{
            label: 'Bar Dataset',
            data: [10, 20, 30, 20, 20, 30, 20, 20, 30, 20, 20, 30, 20, 20, 30, 20, 20],
            backgroundColor: 'rgb(255, 99, 132)',
            borderColor: 'rgb(255, 99, 132)',
            // this dataset is drawn below
            order: 2
        }, {
            label: 'Line Dataset',
            data: [10, 20, 30, 20, 20, 30, 20, 20, 30, 20, 20, 30, 20, 20, 30, 20, 20],
            type: 'line',
            borderColor: 'rgb(0, 99, 132)',
            // this dataset is drawn on top
            order: 1
        }],
        labels: ['6AM', '7AM', '8AM', '9AM', '10AM', '11AM', '12PM', '1PM', '2PM', '3PM', '4PM', '5PM', '6PM', '7PM', '8PM', '9PM', '10PM']
    },

    // Configuration options go here
    options:
    {
      legend: {display: false}
    }
    });

    function sortDate(data, array)
    {
      for (var a = 0; a < data[array].length; a++)
      {
        for (var b = 0; b < data[array].length -a -1; b++)
         {
           // slice the date and split it between 3 integers hour, minute, second between group A and B.
          var hourA = data[array][b].Date.slice(11,13);
          var minuteA = data[array][b].Date.slice(14,16);
          var secondA = data[array][b].Date.slice(17);

          var hourB = data[array][b+1].Date.slice(11,13);
          var minuteB = data[array][b+1].Date.slice(14,16);
          var secondB = data[array][b+1].Date.slice(17);

          // Hours
          if (hourA > hourB)
          {
            var temp = data[array][b];
            data[array][b] = data[array][b+1];
            data[array][b+1] = temp;
          }
          // Minutes
          else if (hourA == hourB && minuteA > minuteB)
          {
            var temp = data[array][b];
            data[array][b] = data[array][b+1];
            data[array][b+1] = temp;
          }
          //Seconds
          else if (hourA == hourB && minuteA == minuteB && secondA > secondB )
          {
            var temp = data[array][b];
            data[array][b] = data[array][b+1];
            data[array][b+1] = temp;
          }
        }
      }
    }

    function myFunction()
    {
      var x = document.getElementById("myTopnav");
      if (x.className === "topnav") {
        x.className += " responsive";
      } else
      {
        x.className = "topnav";
      }
    }

    function prtStatusFunction(data)
    {
      firstObject = 1;
      var length = data[firstObject].length-1;
      let listOfStations = ["PRTLoading_B", "PRTLoading_Evan", "PRTLoading_Eng", "PRTLoading_H", "PRTLoading_W"];
      let listStationIcons = ["PRTIcon_B", "PRTIcon_Evan", "PRTIcon_Eng", "PRTIcon_H", "PRTIcon_W"];

      console.log("Before Sort:" + data[firstObject][length].Date + " " + data[firstObject][length].IsDown);
      sortDate(data,firstObject);
      console.log("After Sort:" + data[firstObject][length].Date + " " + data[firstObject][length].IsDown);
      var currentStatus = data[firstObject][length].IsDown;

      if (currentStatus != "null")
      {
        //PRTLoading_B
        if (currentStatus.search("Beechurst") == -1)
        {
          document.getElementById(listOfStations[0]).innerHTML = "Running";
          document.getElementById(listOfStations[0]).className = 'PRTRunning';
          document.getElementById(listStationIcons[0]).src = "prtRunning.ico";
        }
        else
        {
          document.getElementById(listOfStations[0]).innerHTML = "Down";
          document.getElementById(listOfStations[0]).className = 'PRTDown';
          document.getElementById(listStationIcons[0]).src = "prtDown.ico";
        }

        //PRTLoading_Evan
        if (currentStatus.search("Towers") == -1)
        {
          document.getElementById(listOfStations[1]).innerHTML = "Running";
          document.getElementById(listOfStations[1]).className = 'PRTRunning';
          document.getElementById(listStationIcons[1]).src = "prtRunning.ico";
        }
        else
        {
          document.getElementById(listOfStations[1]).innerHTML = "Down";
          document.getElementById(listOfStations[1]).className = 'PRTDown';
          document.getElementById(listStationIcons[1]).src = "prtDown.ico";
        }

        //PRTLoading_Eng
        if (currentStatus.search("Engineering") == -1)
        {
          document.getElementById(listOfStations[2]).innerHTML = "Running";
          document.getElementById(listOfStations[2]).className = 'PRTRunning';
          document.getElementById(listStationIcons[2]).src = "prtRunning.ico";
        }
        else
        {
          document.getElementById(listOfStations[2]).innerHTML = "Down";
          document.getElementById(listOfStations[2]).className = 'PRTDown';
          document.getElementById(listStationIcons[2]).src = "prtDown.ico";
        }

        //PRTLoading_H
        if (currentStatus.search("HSC") == -1)
        {
          document.getElementById(listOfStations[3]).innerHTML = "Running";
          document.getElementById(listOfStations[3]).className = 'PRTRunning';
          document.getElementById(listStationIcons[3]).src = "prtRunning.ico";
        }
        else
        {
          document.getElementById(listOfStations[3]).innerHTML = "Down";
          document.getElementById(listOfStations[3]).className = 'PRTDown';
          document.getElementById(listStationIcons[3]).src = "prtDown.ico";
        }

        //PRTLoading_W
        if (currentStatus.search("Walnut") == -1)
        {
          document.getElementById(listOfStations[4]).innerHTML = "Running";
          document.getElementById(listOfStations[4]).className = 'PRTRunning';
          document.getElementById(listStationIcons[4]).src = "prtRunning.ico";
        }
        else
        {
          document.getElementById(listOfStations[4]).innerHTML = "Down";
          document.getElementById(listOfStations[4]).className = 'PRTDown';
          document.getElementById(listStationIcons[4]).src = "prtDown.ico";
        }

        if (currentStatus.search("closed") != -1)
        {
          document.getElementById(listOfStations[0]).innerHTML = "Closed";
          document.getElementById(listOfStations[0]).className = 'PRTDown';

          document.getElementById(listOfStations[1]).innerHTML = "Closed";
          document.getElementById(listOfStations[1]).className = 'PRTDown';

          document.getElementById(listOfStations[2]).innerHTML = "Closed";
          document.getElementById(listOfStations[2]).className = 'PRTDown';

          document.getElementById(listOfStations[3]).innerHTML = "Closed";
          document.getElementById(listOfStations[3]).className = 'PRTDown';

          document.getElementById(listOfStations[4]).innerHTML = "Closed";
          document.getElementById(listOfStations[4]).className = 'PRTDown';
        }

      }

      else
      {
        document.getElementById(listOfStations[0]).innerHTML = "Closed";
        document.getElementById(listOfStations[0]).className = 'PRTDown';

        document.getElementById(listOfStations[1]).innerHTML = "Closed";
        document.getElementById(listOfStations[1]).className = 'PRTDown';

        document.getElementById(listOfStations[2]).innerHTML = "Closed";
        document.getElementById(listOfStations[2]).className = 'PRTDown';

        document.getElementById(listOfStations[3]).innerHTML = "Closed";
        document.getElementById(listOfStations[3]).className = 'PRTDown';

        document.getElementById(listOfStations[4]).innerHTML = "Closed";
        document.getElementById(listOfStations[4]).className = 'PRTDown';
      }

    }
    </script>
  </body>

</html>
